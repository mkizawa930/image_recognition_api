<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>{{ title }}</title>
  </head>

  <body>
    <div id="root">
      <h2>画像をアップロードする</h2>
      <p id="error" style="color: red"></p>
      <form id="file-upload" method="POST" enctype="multipart/form-data">
        <input type="file" name="file" required />
        <button type="submit">送信</button>
      </form>
      <div>
        <p id="status"></p>
        <img id="results" hidden />
      </div>
    </div>
  </body>

  <script>
    const form = document.getElementById('file-upload')
    const img = document.getElementById('results')
    const status = document.getElementById('status')
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault()
      const fd = new FormData(form)
    
      const res = await fetch('/api/recognition', { method: 'POST', body: fd })
      if (!res.ok) {
        console.error('API Error')
        return
      }
    
      const data = await res.json()
      console.info(data)
    
      const u = new URL(data.image_url)
      img.src = u.toString()
      img.onload = () => {
        img.hidden = false
        status.textContent = '検出結果'
      }
      img.onerror = () => {} //TODO
    })
  </script>
</html>
